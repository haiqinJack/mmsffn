{"version":3,"sources":["webpack:///webpack/bootstrap ea9cfbd549447659bc4c","webpack:///external \"koa-router\"","webpack:///./server/config/index.js","webpack:///external \"crypto\"","webpack:///external \"mongoose\"","webpack:///./server/index.js","webpack:///external \"koa\"","webpack:///external \"nuxt\"","webpack:///./server/routers/index.js","webpack:///./server/routers/admin.js","webpack:///./server/routers/qiniu.js","webpack:///external \"qiniu\"","webpack:///./server/routers/goods.js","webpack:///external \"xss\"","webpack:///external \"ramda\"","webpack:///./server/api/index.js","webpack:///./server/api/goods.js","webpack:///./server/model/index.js","webpack:///./server/model/goods.js","webpack:///./server/routers/wechat-notify.js","webpack:///./server/tools/index.js","webpack:///external \"koa-bodyparser\"","webpack:///external \"koa-xml-body\"","webpack:///external \"koa-session\"","webpack:///./nuxt.config.js"],"names":["db","qiniu","AK","SK","wechat","appID","appSecret","shop","key","mchId","start","app","host","process","env","HOST","port","PORT","config","require","dev","use","xmlParser","koaBody","keys","CONFIG","maxAge","overwrite","signed","rolling","session","ctx","next","req","routers","routes","allowedMethods","nuxt","builder","build","status","Promise","resolve","reject","res","on","render","promise","then","catch","listen","console","log","router","goods","admin","notify","post","email","password","request","body","pwd","crypto","createHash","update","digest","toUpperCase","adminEmail","adminPassword","nickname","success","data","err","get","accessKey","secretKey","mac","auth","Mac","options","scope","putPolicy","rs","PutPolicy","uploadToken","token","id","Date","getTime","title","xss","info","expressPrice","thumb","R","map","item","imageList","picture","price","sku","tree","k","k_s","v","i","imgUrl","name","list","s1","s1Name","s2","s2Name","s3","s3Name","stock_num","none_sku","collection_id","createGoods","save","mongoose","set","connect","connection","error","async","Goods","model","Schema","GoodsSchema","Number","String","type","enum","Boolean","default","meta","createAt","now","updateAt","pre","isNew","initConfig","appId","partnerKey","all","xml","appid","attach","bank_type","cash_fee","fee_type","is_subscribe","mch_id","nonce_str","openid","out_trade_no","result_code","return_code","sign","time_end","total_fee","trade_type","transaction_id","wechatValidate","RETURN_CODES","SUCCESS","FAIL","formatData","Error","return_msg","err_code","obj","module","exports","head","charset","content","hid","link","rel","href","loading","color","vendor","extend","isDev","isClient","rules","push","enforce","test","loader","exclude","plugins"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 4);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap ea9cfbd549447659bc4c","module.exports = require(\"koa-router\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-router\"\n// module id = 0\n// module chunks = 0","export default {\n\tdb: 'mongodb://localhost/ffn',\n\tqiniu: {\n\t\tAK: 'edi70eWipAzOWzDpd21N7K5WnpTWQ57ivYHJUdQp',\n\t\tSK: 'Y_-O7LA7bV2-P_51ZTt2LBgZd1h3zkNeZbaNcIEc'\n\t},\n\twechat: {\n\t\tappID: 'wxfaa5fc353c6b81d0',\n\t\tappSecret: 'a06a4b363c807ff515e78924cf5d493a',\n\t},\n\tshop: {\n\t\tkey: 'zxcvbnmasdfghjklqwertyuiop123456',\n\t\tmchId: '1493753812'\n\t}\t\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/config/index.js","module.exports = require(\"crypto\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"crypto\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"mongoose\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mongoose\"\n// module id = 3\n// module chunks = 0","import Koa from 'koa'\nimport { Nuxt, Builder } from 'nuxt'\nimport routers from './routers'\nimport koaBody from 'koa-bodyparser'\nimport xmlParser from 'koa-xml-body'\nimport session from 'koa-session'\n\nasync function start () {\n  const app = new Koa()\n  const host = process.env.HOST || '127.0.0.1'\n  const port = process.env.PORT || 3000\n\n  // Import and Set Nuxt.js options\n  let config = require('../nuxt.config.js')\n  config.dev = !(app.env === 'production')\n\n  /**\n   * middleware\n   */\n  app.use(xmlParser())\n  app.use(koaBody())\n  app.keys = ['fafuna']\n\n  const CONFIG = {\n    key: 'koa:sess',\n    maxAge: 86400000,\n    overwrite: true,\n    signed: true,\n    rolling: false,\n  }\n  app.use(session(CONFIG, app))  \n  app.use(async(ctx, next) => {\n    ctx.req.session = ctx.session\n    await next()\n  })\n\n  // router\n  app.use(routers.routes()).use(routers.allowedMethods())\n  // Instantiate nuxt.js\n  const nuxt = new Nuxt(config)\n\n  // Build in development\n  if (config.dev) {\n    const builder = new Builder(nuxt)\n    await builder.build()\n  }\n  \n  app.use(async (ctx, next) => {\n    await next()\n    ctx.status = 200 // koa defaults to 404 when it sees that status is unset\n    return new Promise((resolve, reject) => {\n      ctx.res.on('close', resolve)\n      ctx.res.on('finish', resolve)\n      nuxt.render(ctx.req, ctx.res, promise => {\n        // nuxt.render passes a rejected promise into callback on error.\n        promise.then(resolve).catch(reject)\n      })\n    })\n  })\n\n  app.listen(port, host)\n  console.log('Server listening on ' + host + ':' + port) // eslint-disable-line no-console\n}\n\nstart()\n\n\n\n// WEBPACK FOOTER //\n// ./server/index.js","module.exports = require(\"koa\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"nuxt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"nuxt\"\n// module id = 6\n// module chunks = 0","import Router from 'koa-router'\nimport admin from './admin'\nimport qiniu from './qiniu'\nimport goods from './goods'\nimport notify from './wechat-notify'\n\nconst router = new Router()\n\nrouter.use('/goods', goods.routes(), goods.allowedMethods())\nrouter.use('/admin', admin.routes(), admin.allowedMethods())\nrouter.use('/qiniu', qiniu.routes(), qiniu.allowedMethods())\nrouter.use('/notify', notify.routes(), notify.allowedMethods())\n\nexport default router\n\n\n\n// WEBPACK FOOTER //\n// ./server/routers/index.js","import Router from 'koa-router'\nimport crypto from 'crypto'\n\nconst router = new Router()\n\nrouter.post('/login', (ctx, next) => {\n\tlet { email, password} = ctx.request.body\n\tvar pwd = crypto.createHash('md5').update(password,'utf8').digest('hex').toUpperCase();\n\n\tlet adminEmail = 'root'\n\tlet adminPassword = '448C734BAB346602663CF807DAA5EB2B'\n\tlet admin = {}\n  if(email === adminEmail && pwd === adminPassword){\n  \tadmin = {\n      \temail,\n      \tnickname: 'root'\n    }\n    ctx.session.admin = admin\n    ctx.status = 200\n   \tctx.body = {\n     \tsuccess: true,\n     \tdata: admin\n    }\n  }else if(email !== adminEmail){\n  \tctx.status = 200\n\t\tctx.body = {\n\t\t\tsuccess: false,\n\t\t\terr: '用户名错误'\n\t\t}\t  \t\n  }else {\n  \tctx.status = 200\n\t\tctx.body = {\n\t\t\tsuccess: false,\n\t\t\terr: '密码错误'\n\t\t}\n  }\t\n})\n\nrouter.post('/logout', (ctx, next) => {\n\tctx.session.admin = null\n\tctx.status = 200\n\tctx.body = {\n\t\tsuccess: true\n\t}\n})\nexport default router\n\n\n\n// WEBPACK FOOTER //\n// ./server/routers/admin.js","import Router from 'koa-router'\nimport qiniu from 'qiniu'\nimport config from '../config'\n\nconst router = new Router()\n\nrouter.get('/', (ctx, next) => {\n\tlet accessKey = config.qiniu.AK\n\tlet secretKey = config.qiniu.SK\n\tlet mac = new qiniu.auth.digest.Mac(accessKey, secretKey)\n\tconst options = {\n\t  scope: 'fafuna',\n\t}\n\tconst putPolicy = new qiniu.rs.PutPolicy(options)\n\tconst uploadToken = putPolicy.uploadToken(mac)\n\tctx.status = 200\n\tctx.body = {\n\t\ttoken: uploadToken\n\t}\n})\n\nexport default router\n\n\n\n// WEBPACK FOOTER //\n// ./server/routers/qiniu.js","module.exports = require(\"qiniu\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"qiniu\"\n// module id = 10\n// module chunks = 0","import Router from 'koa-router'\nimport crypto from 'crypto'\nimport xss from 'xss'\nimport R from 'ramda'\nimport * as api from '../api'\n\nconst router = new Router()\n\nrouter.post('/create', async (ctx, next) => {\n\tlet goods = ctx.request.body\n\tlet id = new Date().getTime()\n\tgoods = {\n\t\tid: id,\n\t\ttitle: xss(goods.title),\n\t\tinfo: xss(goods.info),\n\t\texpressPrice: goods.expressPrice,\n\t\tthumb: R.map(item => xss(item), goods.thumb),\n\t\timageList: R.map(item => xss(item),goods.imageList),\n\t\tpicture: xss(goods.picture),\n\t\tprice: (xss(goods.price) * 100),\n\t\tsku: {\n\t\t\ttree: R.map((item) => ({\n\t\t\t\tk: xss(item.k),\n\t\t\t\tk_s: xss(item.k_s),\n\t\t\t\tv: R.map(i => {\n\t\t\t\t\treturn i.imgUrl ? \n\t\t\t\t\t({\n\t\t\t\t\t\tid: i.id? xss(i.id) : i.id,\n\t\t\t\t\t\tname: xss(i.name),\n\t\t\t\t\t\timgUrl: xss(i.imgUrl)\n\t\t\t\t\t}) :\n\t\t\t\t\t({\n\t\t\t\t\t\tid: i.id? xss(i.id) : i.id,\n\t\t\t\t\t\tname: xss(i.name)\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\t)(item.v)\n\t\t\t}), goods.sku.tree),\n\t\t\tlist: R.map(item => ({\n\t\t\t\tid: id,\n\t\t\t\tprice: (xss(goods.price) * 100),\n\t\t\t\ts1: item.s1? xss(item.s1) : item.s1,\n\t\t\t\ts1Name: item.s1Name? xss(item.s1Name) : '',\n\t\t\t\ts2: item.s2? xss(item.s2) : item.s2,\n\t\t\t\ts2Name: item.s2? xss(item.s2Name) : '',\n\t\t\t\ts3: item.s3? xss(item.s3) : item.s3,\n\t\t\t\ts3Name: item.s3Name? xss(item.s3Name): '',\n\t\t\t\tstock_num: item.stock_num? xss(item.stock_num): 0\n\t\t\t}), goods.sku.list),\n\t\t\tprice: xss(goods.price),\n\t\t\tnone_sku: goods.sku.none_sku,\n\t\t\tcollection_id: id,\n\t\t\tstock_num: goods.stock_num? xss(goods.stock_num): goods.stock_num,\n\t\t}\t\t\t\n\t}\n\tconst data = await api.createGoods(goods)\n\n\tctx.body = {\n\t\tsuccess: true,\n\t\tdata: data\n\t}\n})\n\nexport default router\n\n\n\n// WEBPACK FOOTER //\n// ./server/routers/goods.js","module.exports = require(\"xss\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"xss\"\n// module id = 12\n// module chunks = 0","module.exports = require(\"ramda\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"ramda\"\n// module id = 13\n// module chunks = 0","import {\n\tcreateGoods\n} from './goods'\n\nexport {\n\tcreateGoods\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/api/index.js","import { Goods } from '../model'\n\n/**\n * 保存商品\n * @param { Object } goods 商品对象\n */\nexport async function createGoods(goods) {\n\tgoods = new Goods(goods)\n\n\tgoods = await goods.save()\n\n\treturn goods\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/api/goods.js","import mongoose from 'mongoose'\nimport config from '../config'\n\nmongoose.set('debug', true);\n\nmongoose.connect(config.db);\n\nmongoose.connection.on('disconnected', () => {\n\tmongoose.connect(config.db);\t\t\n});\nmongoose.connection.on('error', err => {\n\tconsole.error(err);\n});\nmongoose.connection.on('open', async => {\n\tconsole.log('connected to MongoDB')\n});\n// models\nrequire('./goods');\n\nexport const Goods = mongoose.model('Goods');\n\n\n\n// WEBPACK FOOTER //\n// ./server/model/index.js","const mongoose = require('mongoose')\n\nconst Schema = mongoose.Schema\nconst GoodsSchema = new Schema({\n\tid: Number,\n\ttitle: String,// 标题\n\texpressPrice: Number,// 运费,\n\tprice: Number, // 单价 (分)\n\tpicture: String,// 缩略图\n\tthumb: [// 轮播图\n\t\tString\n\t],\n\timageList: [ // 详细图\n\t\tString\n\t],\n\t// 所有sku规格类目与其值的从属关系，比如商品有颜色和尺码两大类规格，颜色下面又有红色和蓝色两个规格值。\n  // 可以理解为一个商品可以有多个规格类目，一个规格类目下可以有多个规格值。\n\tsku: {\n\t\ttree: [\n\t\t\t{\n\t\t\t\tk: String, // 规格类目\n\t\t\t\tv: [{// 规格值\n\t\t\t\t\tid: String, \n\t\t\t\t\tname: String, \n\t\t\t\t\timgUrl: String\n\t\t\t\t}],\n\t\t\t\tk_s: {// 组合列表（下方 list）中当前类目对应的 key 值，value 值会是从属于当前类目的一个规格值 id\n\t\t\t\t\ttype: String,\n\t\t\t\t\tenum: ['s1', 's2', 's3']\n\t\t\t\t}\n\t\t\t}\n\t\t],\n\t\t// 所有 sku 的组合列表，比如红色、M 码为一个 sku 组合，红色、S 码为另一个组合\n\t\tlist: [{\n\t\t\tid: Number,// skuId，下单时后端需要\n\t\t\tprice: Number,// 价格（单位分）\n\t\t\ts1: String,// 规格类目 k_s 为 s1 的对应规格值 id\n\t\t\ts1Name: String,\n\t\t\ts2: String,// 规格类目 k_s 为 s2 的对应规格值 id\n\t\t\ts2Name: String,\n\t\t\ts3: String,// 规格类目 k_s 为 s3 的对应规格值 id\n\t\t\ts3Name: String,\n\t\t\tstock_num: Number// 当前 sku 组合对应的库存\n\t\t}],\n\t\tprice: Number,// 规格中的默认显示价格（单位元）\n\t\tstock_num: Number,// 商品总库存\n\t\tcollection_id: Number,// 无规格商品 skuId 取 collection_id\n\t\tnone_sku: {// 是否无规格商品\n\t\t\ttype: Boolean,\n\t\t\tdefault: false\n\t\t}\n\t},\n\tmeta: {\n\t\tcreateAt: {\n\t\t\ttype: Date,\n\t\t\tdefault: Date.now()\n\t\t},\n\t\tupdateAt: {\n\t\t\ttype: Date,\n\t\t\tdefault: Date.now()\n\t\t}\n\t}\t\n})\n\nGoodsSchema.pre('save', function(next) {\n\tif(this.isNew){\n\t\tthis.meta.createAt = this.meta.updateAt = Date.now()\n\t}else{\n\t\tthis.meta.updateAt = Date.now()\n\t}\n\n\tnext()\n})\n\nmongoose.model('Goods', GoodsSchema)\n\n\n\n// WEBPACK FOOTER //\n// ./server/model/goods.js","import Router from 'koa-router'\nimport { wechatValidate } from '../tools'\nconst router = new Router()\n\n\nconst initConfig = {\n\tappId: 'wxfaa5fc353c6b81d0',\n\tpartnerKey: 'zxcvbnmasdfghjklqwertyuiop123456',\n\tmchId: 'zxcvbnmasdfghjklqwertyuiop123456'\n}\n\nrouter.all('/', async (ctx, next) => {\n  const body = ctx.request.body\n\n  console.log(body.xml,'body,json')\n  const data = { appid: [ 'wxfaa5fc353c6b81d0' ],\n  attach: [ '法弗纳商城-智能设备&127.0.0.1' ],\n  bank_type: [ 'CFT' ],\n  cash_fee: [ '1' ],\n  fee_type: [ 'CNY' ],\n  is_subscribe: [ 'Y' ],\n  mch_id: [ '1493753812' ],\n  nonce_str: [ 'OZuB0ZFsrZrGVZ5pJuOY8I43KIJuQ1bG' ],\n  openid: [ 'oG02qw5XL-k_goHB-i0sPbv-QAb0' ],\n  out_trade_no: [ 'ffn1527570591892' ],\n  result_code: [ 'SUCCESS' ],\n  return_code: [ 'SUCCESS' ],\n  sign: [ 'DDFDA74E27F9D59E0CE2A3646A916F92' ],\n  time_end: [ '20180529130956' ],\n  total_fee: [ '1' ],\n  trade_type: [ 'JSAPI' ],\n  transaction_id: [ '4200000142201805295049370176' ] }\n  wechatValidate(data)\n  \n})\n\nexport default router\n\n\n\n// WEBPACK FOOTER //\n// ./server/routers/wechat-notify.js","import config from '../config'\n\nconst RETURN_CODES = {\n  SUCCESS: 'SUCCESS',\n  FAIL: 'FAIL'\n}\n\nexport function wechatValidate(data) {\n\tlet error = null\n\tdata = formatData(data)\n  if (data.return_code == RETURN_CODES.FAIL) {\n    error = new Error(data.return_msg);\n    error.name = 'ProtocolError';\n  } else if (data.result_code == RETURN_CODES.FAIL) {\n    error = new Error(data.err_code);\n    error.name = 'BusinessError';\n  } else if (data.appid && config.appId !== data.appid) {\n    error = new Error();\n    error.name = 'InvalidAppId';\n  } else if (data.mch_id && config.mchId !== data.mch_id) {\n    error = new Error();\n    error.name = 'InvalidMchId';\n  } \n}\n\nexport function formatData(data) {\n\tlet obj = {}\n\tfor(var k in data) {\n\t\tobj[k] = data[k][0]\n\t}\n\treturn obj\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/tools/index.js","module.exports = require(\"koa-bodyparser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-bodyparser\"\n// module id = 20\n// module chunks = 0","module.exports = require(\"koa-xml-body\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-xml-body\"\n// module id = 21\n// module chunks = 0","module.exports = require(\"koa-session\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-session\"\n// module id = 22\n// module chunks = 0","module.exports = {\n  /*\n  ** Headers of the page\n  */\n  head: {\n    title: 'nuxt-demo',\n    meta: [\n      { charset: 'utf-8' },\n      { name: 'viewport', content: 'width=device-width, initial-scale=1' },\n      { hid: 'description', name: 'description', content: 'Nuxt.js project' }\n    ],\n    link: [\n      { rel: 'icon', type: 'image/x-icon', href: '/favicon.ico' }\n    ]\n  },\n  /*\n  ** Customize the progress bar color\n  */\n  loading: { color: '#3B8070' },\n  /*\n  ** Build configuration\n  */\n  build: {\n    vendor: [\n      'vant',\n      'axios',\n      'element-ui'\n    ],\n    /*\n    ** Run ESLint on save\n    */\n    extend (config, { isDev, isClient }) {\n      if (isDev && isClient) {\n        config.module.rules.push({\n          enforce: 'pre',\n          test: /\\.(js|vue)$/,\n          loader: 'eslint-loader',\n          exclude: /(node_modules)/\n        })\n      }\n    }\n  },\n  plugins: ['~plugins/element-ui-plugin', '~plugins/vant-plugin']\n}\n\n\n\n// WEBPACK FOOTER //\n// ./nuxt.config.js"],"sourceRoot":""}